http:
  port: ${PORT_HTTP:-8080}
  hostname: '0.0.0.0'
https:
  port: ${PORT_HTTPS:-443}
  hostname: '0.0.0.0'
  tls:
    "default":
      key: ${SSL_KEY_PATH:-./.certs/server.key}
      cert: ${SSL_CERT_PATH:-./.certs/server.crt}

# API ENDPOINTS DEFINITION #

## GATEWAY CUSTOM ENDPOINT ##
apiEndpoints:
  ## ACCOUNT ENDPOINTS ##
  accountPublicApi:
    ### AUTH ###
    - host: '*'
      paths: ['/v1/auth']
      methods: ['POST']

  ## ACTIVITY TRACKING ENDPOINTS ##
  activityPrivateApi:
    ### USERS.CHILDREN.PHYSICALACTIVITIES ###
    - host: '*'
      paths:
        - '/v1/children/:child_id/physicalactivities'
      methods: ["POST"]
      scopes: ['physicalactivities:create']

    - host: '*'
      paths: ['/v1/children/physicalactivities']
      methods: ["GET"]
      scopes: ['physicalactivities:readAll']

    - host: '*'
      paths:
        - '/v1/children/:child_id/physicalactivities'
      methods: ["GET"]
      scopes: ['physicalactivities:read']

    - host: '*'
      paths: ['/v1/children/:child_id/physicalactivities/:physicalactivity_id']
      methods: ["GET"]
      scopes: ['physicalactivities:read']

    - host: '*'
      paths: ['/v1/children/:child_id/physicalactivities/:physicalactivity_id']
      methods: ["PATCH"]
      scopes: ['physicalactivities:update']

    - host: '*'
      paths: ['/v1/children/:child_id/physicalactivities/:physicalactivity_id']
      methods: ["DELETE"]
      scopes: ['physicalactivities:delete']

    ### USERS.CHILDREN.LOGS ###
    - host: '*'
      paths: ['/v1/children/:child_id/logs/date/:date_start/:date_end']
      methods: ["GET"]
      scopes: ['physicalactivities:read']

    - host: '*'
      paths: ['/v1/children/:child_id/logs/:resource/date/:date_start/:date_end']
      methods: ["GET"]
      scopes: ['physicalactivities:read']

    - host: '*'
      paths: ['/v1/children/:child_id/logs/:resource']
      methods: ["POST"]
      scopes: ['physicalactivities:create']

    ### USERS.CHILDREN.SLEEP ###
    - host: '*'
      paths: ['/v1/children/:child_id/sleep']
      methods: ["POST"]
      scopes: ['sleep:create']

    - host: '*'
      paths: ['/v1/children/sleep']
      methods: ["GET"]
      scopes: ['sleep:readAll']

    - host: '*'
      paths:
        - '/v1/children/:child_id/sleep'
        - '/v1/children/:child_id/sleep/*'
      methods: ["GET"]
      scopes: ['sleep:read']

    - host: '*'
      paths: ['/v1/children/:child_id/sleep/:sleep_id']
      methods: ["PATCH"]
      scopes: ['sleep:update']

    - host: '*'
      paths: ['/v1/children/:child_id/sleep/:sleep_id']
      methods: ["DELETE"]
      scopes: ['sleep:delete']

    ### USERS.CHILDREN.WEIGHT / USERS.CHILDREN.BODYFAT ###
    - host: '*'
      paths:
        - '/v1/children/:child_id/weights'
        - '/v1/children/:child_id/bodyfats'
      methods: ["POST"]
      scopes: ['measurements:create']

    - host: '*'
      paths:
        - '/v1/children/:child_id/weights'
        - '/v1/children/:child_id/bodyfats'
      methods: ["GET"]
      scopes: ['measurements:read']

    - host: '*'
      paths:
        - '/v1/children/:child_id/weights/:weight_id'
        - '/v1/children/:child_id/bodyfats/:bodyfat_id'
      methods: ["GET"]
      scopes: ['measurements:read']

    - host: '*'
      paths:
        - '/v1/children/:child_id/weights/:weight_id'
        - '/v1/children/:child_id/bodyfats/:bodyfat_id'
      methods: ["DELETE"]
      scopes: ['measurements:delete']

  ## ENVIRONMENT ENDPOINTS ##
  environmentPrivateAPI:
    ### ENVIRONMENTS ###
    - host: '*'
      paths: ['/v1/environments']
      methods: ["POST"]
      scopes: ['environment:create']

    - host: '*'
      paths: ['/v1/environments']
      methods: ["GET"]
      scopes: ['environment:read']

    - host: '*'
      paths: ['/v1/environments/:environment_id']
      methods: ["DELETE"]
      scopes: ['environment:delete']

  accountPrivateApi:
    ### USERS ###
    - host: '*'
      paths: ['/v1/users/:user_id']
      methods: ['DELETE']
      scopes: ['users:delete']

    - host: '*'
      paths: ['/v1/users/:user_id/password']
      methods: ['PUT']
      scopes: ['applications:update', 'children:update', 'educators:update', 'families:update', 'healthprofessionals:update']

    - host: '*'
      paths: ['/v1/users/:user_id/reset-password']
      methods: ['POST']
      scopes: ['users:resetPassword']

    ### USERS.CHILDREN ###
    - host: '*'
      paths: ['/v1/children']
      methods: ['POST']
      scopes: ['children:create']

    - host: '*'
      paths: ['/v1/children']
      methods: ['GET']
      scopes: ['children:readAll']

    - host: '*'
      paths: ['/v1/children/:child_id']
      methods: ['GET']
      scopes: ['children:read']

    - host: '*'
      paths: ['/v1/children/:child_id']
      methods: ['PATCH']
      scopes: ['children:update']

    - host: '*'
      paths: ['/v1/children/:child_id']
      methods: ['DELETE']
      scopes: ['children:delete']

    ### USERS.EDUCATORS ###
    - host: '*'
      paths: ['/v1/educators']
      methods: ['POST']
      scopes: ['educators:create']

    - host: '*'
      paths: ['/v1/educators']
      methods: ['GET']
      scopes: ['educators:readAll']

    - host: '*'
      paths: ['/v1/educators/:educator_id']
      methods: ['GET']
      scopes: ['educators:read']

    - host: '*'
      paths: ['/v1/educators/:educator_id']
      methods: ['PATCH']
      scopes: ['educators:update']

    - host: '*'
      paths: ['/v1/educators/:educator_id']
      methods: ['DELETE']
      scopes: ['educators:delete']

    ### USERS.FAMILIES || USERS.FAMILIES.CHILDREN ###
    - host: '*'
      paths: ['/v1/families', '/v1/families/:family_id/children/:child_id']
      methods: ['POST']
      scopes: ['families:create']

    - host: '*'
      paths: ['/v1/families']
      methods: ['GET']
      scopes: ['families:readAll']

    - host: '*'
      paths: ['/v1/families/:family_id', '/v1/families/:family_id/children']
      methods: ['GET']
      scopes: ['families:read']

    - host: '*'
      paths: ['/v1/families/:family_id']
      methods: ['PATCH']
      scopes: ['families:update']

    - host: '*'
      paths:
        - '/v1/families/:family_id'
        - '/v1/families/:family_id/children/:child_id'
      methods: ['DELETE']
      scopes: ['families:delete']

    ### USERS.HEALTHPROFESSIONALS ###
    - host: '*'
      paths: ['/v1/healthprofessionals']
      methods: ['POST']
      scopes: ['healthprofessionals:create']

    - host: '*'
      paths: ['/v1/healthprofessionals']
      methods: ['GET']
      scopes: ['healthprofessionals:readAll']

    - host: '*'
      paths: ['/v1/healthprofessionals/:healthprofessional_id']
      methods: ['GET']
      scopes: ['healthprofessionals:read']

    - host: '*'
      paths: ['/v1/healthprofessionals/:healthprofessional_id']
      methods: ['PATCH']
      scopes: ['healthprofessionals:update']

    - host: '*'
      paths: ['/v1/healthprofessionals/:healthprofessional_id']
      methods: ['DELETE']
      scopes: ['healthprofessionals:delete']

    ### USERS.EDUCATORS.CHILDREN.GROUPS || USERS.HEALTHPROFESSIONALS.CHILDREN.GROUPS ###
    - host: '*'
      paths:
        - '/v1/educators/:educator_id/children/groups'
        - '/v1/healthprofessionals/:healthprofessional_id/children/groups'
      methods: ['POST']
      scopes: ['childrengroups:create']

    - host: '*'
      paths:
        - '/v1/educators/:educator_id/children/groups'
        - '/v1/educators/:educator_id/children/groups/:group_id'
        - '/v1/healthprofessionals/:healthprofessional_id/children/groups'
        - '/v1/healthprofessionals/:healthprofessional_id/children/groups/:group_id'
      methods: ['GET']
      scopes: ['childrengroups:read']

    - host: '*'
      paths:
        - '/v1/educators/:educator_id/children/groups/:group_id'
        - '/v1/healthprofessionals/:healthprofessional_id/children/groups/:group_id'
      methods: ['PATCH']
      scopes: ['childrengroups:update']

    - host: '*'
      paths:
        - '/v1/educators/:educator_id/children/groups/:group_id'
        - '/v1/healthprofessionals/:healthprofessional_id/children/groups/:group_id'
      methods: ['DELETE']
      scopes: ['childrengroups:delete']

    ### USERS.APPLICATIONS ###
    - host: '*'
      paths: ['/v1/applications']
      methods: ['POST']
      scopes: ['applications:create']

    - host: '*'
      paths: ['/v1/applications']
      methods: ['GET']
      scopes: ['applications:readAll']

    - host: '*'
      paths: ['/v1/applications/:application_id']
      methods: ['GET']
      scopes: ['applications:read']

    - host: '*'
      paths: ['/v1/applications/:application_id']
      methods: ['PATCH']
      scopes: ['applications:update']

    - host: '*'
      paths: ['/v1/applications/:application_id']
      methods: ['DELETE']
      scopes: ['applications:delete']

    ### INSTITUTIONS ###
    - host: '*'
      paths: ['/v1/institutions']
      methods: ['POST']
      scopes: ['institutions:create']

    - host: '*'
      paths: ['/v1/institutions']
      methods: ['GET']
      scopes: ['institutions:readAll']

    - host: '*'
      paths: ['/v1/institutions/:institution_id']
      methods: ['GET']
      scopes: ['institutions:read']

    - host: '*'
      paths: ['/v1/institutions/:institution_id']
      methods: ['PATCH']
      scopes: ['institutions:update']

    - host: '*'
      paths: ['/v1/institutions/:institution_id']
      methods: ['DELETE']
      scopes: ['institutions:delete']

  ## DATA ACQUISITION AGENT ENDPOINTS ##
  daAgentPrivateApi:
  ### USERS.FITBIT.AUTH ###
    - host: '*'
      paths: ['/v1/users/:user_id/fitbit/auth']
      methods: ['POST', 'GET']

    - host: '*'
      paths: ['/v1/users/:user_id/fitbit/auth/revoke']
      methods: ['POST']

  ### USERS.FITBIT.SYNC ###
    - host: '*'
      paths: ['/v1/users/:user_id/fitbit/sync']
      methods: ['POST']

  ## QUESTIONNAIRE ENDPOINTS ##
  questionnairesPrivateAPI:
    ### Q1SOCIODEMOGRAPHIC ###
    - host: '*'
      paths:
        - '/q1sociodemographics'
        - '/q1sociodemographics/:id'
        - '/q1sociodemographics/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q1sociodemographics/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q1sociodemographics/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q1sociodemographics']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q1sociodemographics']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q21CHILDSHEALTHCONDITIONS ###
    - host: '*'
      paths:
        - '/q21childshealthconditions'
        - '/q21childshealthconditions/:id'
        - '/q21childshealthconditions/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q21childshealthconditions/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q21childshealthconditions/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q21childshealthconditions']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q21childshealthconditions']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q22PARENTSHEALTHCONDITIONS ###
    - host: '*'
      paths:
        - '/q22parentshealthconditions'
        - '/q22parentshealthconditions/:id'
        - '/q22parentshealthconditions/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q22parentshealthconditions/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q22parentshealthconditions/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q22parentshealthconditions']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q22parentshealthconditions']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q3PHYSICALANTHROPOMETRICMEASURES ###
    - host: '*'
      paths:
        - '/q3physicalandanthropometricmeasures'
        - '/q3physicalandanthropometricmeasures/:id'
        - '/q3physicalandanthropometricmeasures/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q3physicalandanthropometricmeasures/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q3physicalandanthropometricmeasures/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q3physicalandanthropometricmeasures']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q3physicalandanthropometricmeasures']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q401FOODFREQUENCY ###
    - host: '*'
      paths:
        - '/q401ffq'
        - '/q401ffq/:id'
        - '/q401ffq/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q401ffq/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q401ffq/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q401ffq']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q401ffq']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q402FOODHABITSANDFEEDINGBEHAVIOURS ###
    - host: '*'
      paths:
        - '/q402foodhabitsandfeedingbehaviors'
        - '/q402foodhabitsandfeedingbehaviors/:id'
        - '/q402foodhabitsandfeedingbehaviors/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q402foodhabitsandfeedingbehaviors/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q402foodhabitsandfeedingbehaviors/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q402foodhabitsandfeedingbehaviors']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q402foodhabitsandfeedingbehaviors']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q501PHYSICALACTIVITYFORCHILDREN ###
    - host: '*'
      paths:
        - '/q501physicalactivityforchildren'
        - '/q501physicalactivityforchildren/:id'
        - '/q501physicalactivityforchildren/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q501physicalactivityforchildren/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q501physicalactivityforchildren/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q501physicalactivityforchildren']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q501physicalactivityforchildren']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q502PHYSICALACTIVITYANDSEDENTARYHABITS ###
    - host: '*'
      paths:
        - '/q502physicalactivityandsedentaryhabits'
        - '/q502physicalactivityandsedentaryhabits/:id'
        - '/q502physicalactivityandsedentaryhabits/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q502physicalactivityandsedentaryhabits/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q502physicalactivityandsedentaryhabits/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q502physicalactivityandsedentaryhabits']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q502physicalactivityandsedentaryhabits']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q503SLEEPINGHABITS ###
    - host: '*'
      paths:
        - '/q503sleepinghabits'
        - '/q503sleepinghabits/:id'
        - '/q503sleepinghabits/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q503sleepinghabits/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q503sleepinghabits/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q503sleepinghabits']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q503sleepinghabits']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q601CHILDEATINGBEHAVIOUR ###
    - host: '*'
      paths:
        - '/q601childeatingbehaviour'
        - '/q601childeatingbehaviour/:id'
        - '/q601childeatingbehaviour/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q601childeatingbehaviour/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q601childeatingbehaviour/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q601childeatingbehaviour']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q601childeatingbehaviour']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### Q602AUTOPERCEPTION ###
    - host: '*'
      paths:
        - '/q602autoperception'
        - '/q602autoperception/:id'
        - '/q602autoperception/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/q602autoperception/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/q602autoperception/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/q602autoperception']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/q602autoperception']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

    ### QUESTION ###
    - host: '*'
      paths:
        - '/questions'
        - '/questions/:id'
        - '/questions/count'
      methods: ["GET"]
      scopes: ['questionnaires:read']

    - host: '*'
      paths: ['/questions/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['questionnaires:update']

    - host: '*'
      paths: ['/questions/:id']
      methods: ["DELETE"]
      scopes: ['questionnaires:delete']

    - host: '*'
      paths: ['/questions']
      methods: ["POST"]
      scopes: ['questionnaires:create']

    - host: '*'
      paths: ['/questions']
      methods: ["PATCH"]
      scopes: ['questionnaires:update']

  ## GAMIFICATION ENDPOINTS ##
  gamificationPrivateAPI:
    ### AGENT_REPORT ###
    - host: '*'
      paths:
        - '/agentreports'
        - '/agentreports/:id'
        - '/agentreports/count'
      methods: ['GET']
      scopes: ['gamificationprofile:read']

    - host: '*'
      paths: ['/agentreports/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['gamificationprofile:update']

    - host: '*'
      paths: ['/agentreports/:id']
      methods: ["DELETE"]
      scopes: ['gamificationprofile:delete']

    - host: '*'
      paths: ['/agentreports']
      methods: ["POST"]
      scopes: ['gamificationprofile:create']

    - host: '*'
      paths: ['/agentreports']
      methods: ["PATCH"]
      scopes: ['gamificationprofile:update']

    ### BADGE ###
    - host: '*'
      paths:
        - '/badges'
        - '/badges/:id'
        - '/badges/count'
      methods: ['GET']
      scopes: ['gamificationprofile:read']

    - host: '*'
      paths: ['/badges/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['gamificationprofile:update']

    - host: '*'
      paths: ['/badges/:id']
      methods: ["DELETE"]
      scopes: ['gamificationprofile:delete']

    - host: '*'
      paths: ['/badges']
      methods: ["POST"]
      scopes: ['gamificationprofile:create']

    - host: '*'
      paths: ['/badges']
      methods: ["PATCH"]
      scopes: ['gamificationprofile:update']

    ### CUSTOMIZATION ITEM ###
    - host: '*'
      paths:
        - '/customizationitems'
        - '/customizationitems/:id'
        - '/customizationitems/count'
      methods: ['GET']
      scopes: ['gamificationprofile:read']

    - host: '*'
      paths: ['/customizationitems/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['gamificationprofile:update']

    - host: '*'
      paths: ['/customizationitems/:id']
      methods: ["DELETE"]
      scopes: ['gamificationprofile:delete']

    - host: '*'
      paths: ['/customizationitems']
      methods: ["POST"]
      scopes: ['gamificationprofile:create']

    - host: '*'
      paths: ['/customizationitems']
      methods: ["PATCH"]
      scopes: ['gamificationprofile:update']

    ### GAMIFICATION PROFILE ###
    - host: '*'
      paths:
        - '/gamificationprofiles'
        - '/gamificationprofiles/:id'
        - '/gamificationprofiles/count'
      methods: ['GET']
      scopes: ['gamificationprofile:read']

    - host: '*'
      paths: ['/gamificationprofiles/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['gamificationprofile:update']

    - host: '*'
      paths: ['/gamificationprofiles/:id']
      methods: ["DELETE"]
      scopes: ['gamificationprofile:delete']

    - host: '*'
      paths: ['/gamificationprofiles']
      methods: ["POST"]
      scopes: ['gamificationprofile:create']

    - host: '*'
      paths: ['/gamificationprofiles']
      methods: ["PATCH"]
      scopes: ['gamificationprofile:update']

  ## MISSIONS ENDPOINTS ##
  missionsPrivateAPI:
    ### MISSION ###
    - host: '*'
      paths:
        - '/missions'
        - '/missions/:id'
        - '/missions/count'
      methods: ['GET']
      scopes: ['missions:read']

    - host: '*'
      paths: ['/missions/:id']
      methods: ["PUT", "PATCH"]
      scopes: ['missions:update']

    - host: '*'
      paths: ['/missions/:id']
      methods: ["DELETE"]
      scopes: ['missions:delete']

    - host: '*'
      paths: ['/missions']
      methods: ["POST"]
      scopes: ['missions:create']

    - host: '*'
      paths: ['/missions']
      methods: ["PATCH"]
      scopes: ['missions:update']

####### SERVICE ENDPOINTS DEFINITIONS ########
serviceEndpoints:
  gatewayService:
    url: '${API_GATEWAY_SERVICE:-http://localhost:8080}'
  accountService:
    url: '${ACCOUNT_SERVICE:-https://localhost:3001}'
  activityService:
    url: '${ACTIVITY_SERVICE:-https://localhost:4001}'
  daAgentService:
    url: '${DA_AGENT_SERVICE:-https://localhost:5001}'
  questionnaireService:
    url: '${QUESTIONNAIRE_SERVICE:-http://localhost:6001}'
  gamificationService:
    url: '${GAMIFICATION_SERVICE:-http://localhost:6001}'
  missionService:
    url: '${MISSION_SERVICE:-http://localhost:6001}'

####### POLICIES USED IN PIPELINES DEFINITION ########
policies:
  - log
  - proxy
  - rate-limit
  - jwtScopes-policy
  - jwt-policy
  - auth-policy
  - body-parser-policy
  - delete-user-policy

####### PIPELINES DEFINITION ########
#### Pipeline no manage data coming from ACCOUNT PRIVATE and PUBLIC APIs ####
pipelines:
  accountPublicPipeline:
    apiEndpoints: ['accountPublicApi']
    policies:
      - body-parser-policy:
      - auth-policy:
          - condition:
              name: 'regex-path-method'
              #regexPath é uma expressão regular
              regexPath: '^(\/v1\/auth\/{0,1})$'
              method: 'POST'
            action:
              urlAuthService: ${ACCOUNT_SERVICE:-https://localhost:3001}/v1/auth
              secretOrPublicKeyFile: ${JWT_PUBLIC_KEY_PATH:-./.certs/jwt.pem}
              issuer: ${ISSUER:-ocariot}
      - proxy:
          - action:
              prependPath:  true
              ignorePath:   false
              stripPath:    false
              changeOrigin: true
              timeout: 10000
              secure: false
              serviceEndpoint: accountService

  accountPrivatePipeline:
    apiEndpoints: ['accountPrivateApi']
    policies:
      - body-parser-policy:
      - jwt-policy:
          - action:
              secretOrPublicKeyFile: ${JWT_PUBLIC_KEY_PATH:-./.certs/jwt.pem}
              issuer: ${ISSUER:-ocariot}
      - jwtScopes-policy:
      - delete-user-policy:
          - condition:
              name: 'regex-path-method'
              #regexPath é uma expressão regular
              regexPath: '^(\/v1\/users\/)[a-fA-F0-9]{24}\/{0,1}$'
              method: 'DELETE'
            action:
              urlDeleteService: ${ACCOUNT_SERVICE:-https://localhost:3001}/v1/users
      - proxy:
          - action:
              prependPath:  true
              ignorePath:   false
              stripPath:    false
              changeOrigin: true
              secure: false
              timeout: 10000
              serviceEndpoint: accountService

  #### Pipelines to manage data coming from ACTIVITY PRIVATE and PUBLIC APIs ####
  activityPrivatePipeline:
    apiEndpoints: ['activityPrivateApi', 'environmentPrivateAPI']
    policies:
      - body-parser-policy:
      - jwt-policy:
          - action:
              secretOrPublicKeyFile: ${JWT_PUBLIC_KEY_PATH:-./.certs/jwt.pem}
              issuer: ${ISSUER:-ocariot}
      - jwtScopes-policy:
      - proxy:
          - action:
              prependPath:  true
              ignorePath:   false
              stripPath:    false
              changeOrigin: true
              secure: false
              timeout: 10000
              serviceEndpoint: activityService

  #### Pipelines to manage data coming from DATA ACQUISITION AGENT PRIVATE and PUBLIC APIs ####
  daAgentPrivatePipeline:
    apiEndpoints: ['daAgentPrivateApi']
    policies:
      - body-parser-policy:
      - jwt-policy:
          - action:
              secretOrPublicKeyFile: ${JWT_PUBLIC_KEY_PATH:-./.certs/jwt.pem}
              issuer: ${ISSUER:-ocariot}
      - jwtScopes-policy:
      - proxy:
          - action:
              prependPath:  true
              ignorePath:   false
              stripPath:    false
              changeOrigin: true
              secure: false
              timeout: 10000
              serviceEndpoint: daAgentService

  #### Pipelines to manage data coming from QUESTIONNAIRES PRIVATE and PUBLIC APIs ####
  questionnairesPrivatePipeline:
    apiEndpoints: ['questionnairesPrivateAPI']
    policies:
      - body-parser-policy:
      - jwt-policy:
          - action:
              secretOrPublicKeyFile: ${JWT_PUBLIC_KEY_PATH:-./.certs/jwt.pem}
              issuer: ${ISSUER:-ocariot}
      - jwtScopes-policy:
      - proxy:
          - action:
              prependPath:  true
              ignorePath:   false
              stripPath:    false
              changeOrigin: true
              secure: false
              timeout: 10000
              serviceEndpoint: questionnaireService

  #### Pipelines to manage data coming from GAMIFICATION PRIVATE and PUBLIC APIs ####
  gamificationPrivatePipeline:
    apiEndpoints: ['gamificationPrivateAPI']
    policies:
      - body-parser-policy:
      - jwt-policy:
          - action:
              secretOrPublicKeyFile: ${JWT_PUBLIC_KEY_PATH:-./.certs/jwt.pem}
              issuer: ${ISSUER:-ocariot}
      - jwtScopes-policy:
      - proxy:
          - action:
              prependPath:  true
              ignorePath:   false
              stripPath:    false
              changeOrigin: true
              secure: false
              timeout: 10000
              serviceEndpoint: gamificationService

  #### Pipelines to manage data coming from MISSIONS PRIVATE and PUBLIC APIs ####
  missionsPrivatePipeline:
    apiEndpoints: ['missionsPrivateAPI']
    policies:
      - body-parser-policy:
      - jwt-policy:
          - action:
              secretOrPublicKeyFile: ${JWT_PUBLIC_KEY_PATH:-./.certs/jwt.pem}
              issuer: ${ISSUER:-ocariot}
      - jwtScopes-policy:
      - proxy:
          - action:
              prependPath:  true
              ignorePath:   false
              stripPath:    false
              changeOrigin: true
              secure: false
              timeout: 10000
              serviceEndpoint: missionService
